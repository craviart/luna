name: 🔄 Automatic Website Analysis

on:
  schedule:
    # Run 3 times daily: 7 AM, 1 PM, and 9 PM London time
    # Note: GitHub Actions runs in UTC, these times account for BST (British Summer Time)
    - cron: '0 6 * * *'   # 7:00 AM London (6 AM UTC + 1 hour BST, 7 AM UTC in winter)
    - cron: '0 12 * * *'  # 1:00 PM London (12 PM UTC + 1 hour BST, 1 PM UTC in winter)  
    - cron: '0 20 * * *'  # 9:00 PM London (8 PM UTC + 1 hour BST, 9 PM UTC in winter)
  
  # Allow manual triggering from GitHub Actions UI
  workflow_dispatch:

jobs:
  analyze:
    name: 🔍 Trigger Luna Analytics Analysis
    runs-on: ubuntu-latest
    
    steps:
      - name: 📊 Run Automatic Analysis
        run: |
          echo "🚀 Starting Luna Analytics automatic analysis at $(date)"
          echo "🌐 Triggering analysis via: https://millie-static.vercel.app/api/cron-analyze"
          
          # Make the API call and capture response
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET "https://millie-static.vercel.app/api/cron-analyze" \
            -H "User-Agent: GitHub-Actions-Luna-Analytics/1.0")
          
          echo "📈 API Response Code: $response"
          
          # Check if the request was successful
          if [ $response -eq 200 ]; then
            echo "✅ Analysis triggered successfully!"
            echo "📊 All monitored URLs will be analyzed automatically"
          else
            echo "❌ Analysis failed with HTTP status: $response"
            echo "🔧 Please check the Vercel function logs for details"
            exit 1
          fi
          
          echo "🎯 Analysis complete! Check Luna Analytics dashboard for results."